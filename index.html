<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¨éŸ³è½‰ç›¤éŠæˆ²-ç©©å®šä¿®å¾©ç‰ˆ</title>
    <style>
        :root {
            --primary-color: #FF9AA2;
            --bg-color: #FFF9F2;
            --text-color: #333;
            --wheel-border: #fff;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow-y: auto; 
            padding: 20px 0;
        }

        h1 {
            color: #666;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.05);
            text-align: center;
            font-weight: 800;
            letter-spacing: 2px;
            font-size: 28px;
        }

        .game-container {
            position: relative;
            width: 350px;
            height: 350px;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none; 
            -webkit-user-select: none;
        }

        .pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #FF6F91;
            z-index: 100;
            filter: drop-shadow(0 3px 3px rgba(0,0,0,0.2));
        }

        .wheel {
            position: absolute;
            border-radius: 50%;
            transition: transform 4s cubic-bezier(0.1, 0, 0.2, 1);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background: white;
        }

        .wheel-item {
            position: absolute;
            top: 0;
            left: 50%;
            transform-origin: 50% 100%;
            display: flex;
            justify-content: center;
            padding-top: 5px;
            font-weight: bold;
            color: #333;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.6);
            box-sizing: border-box;
            user-select: none;
        }

        /* å¤–å±¤ï¼šè²æ¯ */
        .outer-ring {
            width: 340px;
            height: 340px;
            z-index: 1;
            font-size: 18px;
        }
        .outer-ring .wheel-item {
            height: 170px;
            width: 40px;
            margin-left: -20px;
        }

        /* ä¸­å±¤ï¼šéŸ»æ¯ */
        .middle-ring {
            width: 240px;
            height: 240px;
            z-index: 2;
            font-size: 20px;
            border: 4px solid var(--wheel-border);
        }
        .middle-ring .wheel-item {
            height: 120px;
            width: 40px;
            margin-left: -20px;
            padding-top: 5px;
        }

        /* å…§å±¤ï¼šè²èª¿ */
        .inner-ring {
            width: 140px;
            height: 140px;
            z-index: 3;
            font-size: 24px;
            border: 4px solid var(--wheel-border);
        }
        .inner-ring .wheel-item {
            height: 70px;
            width: 60px;
            margin-left: -30px;
            padding-top: 15px;
        }

        .center-btn {
            position: absolute;
            width: 65px;
            height: 65px;
            background: radial-gradient(circle at 30% 30%, #FFB7B2, #FF9AA2);
            border-radius: 50%;
            z-index: 10;
            border: 5px solid white;
            box-shadow: 0 5px 15px rgba(255, 154, 162, 0.4);
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #333;
            font-size: 18px;
            transition: transform 0.1s;
        }

        .center-btn:active {
            transform: scale(0.95);
        }

        .result-panel {
            margin-top: 25px;
            background: white;
            padding: 20px 35px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            text-align: center;
            min-width: 280px;
            z-index: 10;
            border: 2px solid #FFF0F5; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .result-labels {
            display: flex;
            justify-content: space-around;
            font-size: 15px;
            color: #888;
            margin-bottom: 8px;
            font-weight: bold;
            width: 100%;
        }

        .result-boxes {
            display: flex;
            justify-content: center;
            gap: 12px;
        }

        .result-box {
            width: 65px;
            height: 65px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            font-weight: bold;
            color: #333;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }

        .box-initial { background-color: #FF9AA2; }
        .box-final { background-color: #88D8B0; }
        .box-tone { background-color: #FFDAC1; }
        
        .full-sound {
            margin-top: 15px;
            font-size: 22px;
            color: #666;
            height: 28px;
            font-weight: bold;
        }

        /* æœ—è®€æŒ‰éˆ•æ¨£å¼ */
        .speak-btn {
            margin-top: 15px;
            padding: 10px 28px;
            background-color: #4ECDC4;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.2s;
            display: none; 
            align-items: center;
            gap: 8px;
            /* é˜²æ­¢é›™æ“Šé¸å– */
            user-select: none;
            -webkit-user-select: none;
            /* å¢åŠ é»æ“Šå€åŸŸ */
            touch-action: manipulation;
        }

        .speak-btn:hover {
            background-color: #36b9b0;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }

        .speak-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        @media (max-width: 400px) {
            .game-container {
                transform: scale(0.85);
            }
            .result-panel {
                min-width: 260px;
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>

    <h1>æ³¨éŸ³è½‰ç›¤éŠæˆ²</h1>

    <div class="game-container">
        <div class="pointer"></div>
        <div class="wheel outer-ring" id="wheel-initial"></div>
        <div class="wheel middle-ring" id="wheel-final"></div>
        <div class="wheel inner-ring" id="wheel-tone"></div>
        <div class="center-btn" onclick="spinWheel()">é–‹å§‹</div>
    </div>

    <div class="result-panel">
        <div class="result-labels">
            <span style="width: 65px">è²æ¯</span>
            <span style="width: 65px">éŸ»æ¯</span>
            <span style="width: 65px">è²èª¿</span>
        </div>
        <div class="result-boxes">
            <div class="result-box box-initial" id="res-initial">?</div>
            <div class="result-box box-final" id="res-final">?</div>
            <div class="result-box box-tone" id="res-tone">?</div>
        </div>
        <div class="full-sound" id="res-text">æº–å‚™é–‹å§‹...</div>
        <!-- æœ—è®€æŒ‰éˆ• -->
        <button class="speak-btn" onclick="safeSpeakResult()">ğŸ”Š è½ç™¼éŸ³</button>
    </div>

    <script>
        // å°‡æ‰€æœ‰é‚è¼¯åŒ…åœ¨ DOMContentLoaded ç¢ºä¿ç•«é¢å…ƒç´ å­˜åœ¨å¾Œæ‰åŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const initials = [
                    'ã„…','ã„†','ã„‡','ã„ˆ','ã„‰','ã„Š','ã„‹','ã„Œ','ã„','ã„','ã„',
                    'ã„','ã„‘','ã„’','ã„“','ã„”','ã„•','ã„–','ã„—','ã„˜','ã„™'
                ];
                
                const finals = [
                    'ã„š','ã„›','ã„œ','ã„','ã„','ã„Ÿ','ã„ ','ã„¡','ã„¢','ã„£','ã„¤','ã„¥','ã„¦',
                    'ã„§','ã„¨','ã„©'
                ];
                
                const tones = [
                    { label: ' ', name: 'ä¸€è²', display: ' ' },
                    { label: 'ËŠ', name: 'äºŒè²', display: 'ËŠ' },
                    { label: 'Ë‡', name: 'ä¸‰è²', display: 'Ë‡' },
                    { label: 'Ë‹', name: 'å››è²', display: 'Ë‹' }
                ];

                // === åš´æ ¼è³‡æ–™åº« (White List) ===
                const toneDatabase = {
                    'ã„…ã„š': [0, 1, 2, 3], 'ã„…ã„›': [0, 1, 2, 3], 'ã„…ã„': [0, 1, 2, 3], 'ã„…ã„Ÿ': [0, 2, 3], 
                    'ã„…ã„ ': [0, 2, 3], 'ã„…ã„¢': [0, 2, 3], 'ã„…ã„£': [0, 2, 3], 'ã„…ã„¤': [0, 2, 3], 'ã„…ã„¥': [0, 2, 3],
                    'ã„…ã„§': [0, 1, 2, 3], 'ã„…ã„¨': [0, 2, 3],
                    'ã„†ã„š': [0, 1, 3], 'ã„†ã„›': [0, 1, 2, 3], 'ã„†ã„': [0, 1, 2, 3], 'ã„†ã„Ÿ': [0, 1, 2, 3], 
                    'ã„†ã„ ': [0, 1, 3], 'ã„†ã„¡': [0, 3], 'ã„†ã„¢': [0, 1, 2, 3], 'ã„†ã„£': [0, 1, 3], 
                    'ã„†ã„¤': [0, 1, 2], 'ã„†ã„¥': [0, 1, 2, 3], 'ã„†ã„§': [0, 1, 2, 3], 'ã„†ã„¨': [0, 1, 2, 3],
                    'ã„‡ã„š': [0, 1, 2, 3], 'ã„‡ã„›': [0, 1, 2, 3], 'ã„‡ã„œ': [0], 
                    'ã„‡ã„': [1, 2, 3], 'ã„‡ã„Ÿ': [1, 2, 3], 'ã„‡ã„ ': [0, 1, 2, 3], 'ã„‡ã„¡': [1, 2, 3], 
                    'ã„‡ã„¢': [1, 2, 3], 'ã„‡ã„£': [1, 3], 'ã„‡ã„¤': [1, 2], 'ã„‡ã„¥': [0, 1, 2, 3], 
                    'ã„‡ã„§': [0, 1, 2, 3], 'ã„‡ã„¨': [0, 2, 3],
                    'ã„ˆã„š': [0, 1, 2, 3], 'ã„ˆã„›': [1], 'ã„ˆã„Ÿ': [0, 1, 2, 3], 'ã„ˆã„¡': [2, 3], 
                    'ã„ˆã„¢': [0, 1, 2, 3], 'ã„ˆã„£': [0, 1, 2, 3], 'ã„ˆã„¤': [0, 1, 2, 3], 'ã„ˆã„¥': [0, 1, 2, 3], 
                    'ã„ˆã„¨': [0, 1, 2, 3],
                    'ã„‰ã„š': [0, 1, 2, 3], 'ã„‰ã„œ': [1], 'ã„‰ã„': [0, 2, 3], 'ã„‰ã„ ': [0, 2, 3], 'ã„‰ã„¡': [0, 2, 3], 
                    'ã„‰ã„¢': [0, 2, 3], 'ã„‰ã„£': [3], 'ã„‰ã„¤': [0, 2, 3], 'ã„‰ã„¥': [0, 2, 3], 'ã„‰ã„§': [0, 1, 2, 3], 'ã„‰ã„¨': [0, 1, 2, 3],
                    'ã„Šã„š': [0, 2, 3], 'ã„Šã„œ': [3], 'ã„Šã„': [0, 1, 2, 3], 'ã„Šã„ ': [0, 1, 2, 3], 'ã„Šã„¡': [0, 1, 2, 3], 
                    'ã„Šã„¢': [0, 1, 2, 3], 'ã„Šã„¤': [0, 1, 2, 3], 'ã„Šã„¥': [0, 1, 2], 'ã„Šã„§': [0, 1, 2, 3], 'ã„Šã„¨': [0, 1, 2, 3],
                    'ã„‹ã„š': [1, 2, 3], 'ã„‹ã„œ': [3], 'ã„‹ã„': [2, 3], 'ã„‹ã„Ÿ': [2, 3], 'ã„‹ã„ ': [1, 2, 3], 'ã„‹ã„¡': [3], 
                    'ã„‹ã„¢': [0, 1, 2, 3], 'ã„‹ã„£': [3], 'ã„‹ã„¤': [1, 2, 3], 'ã„‹ã„¥': [1, 2], 'ã„‹ã„§': [0, 1, 2, 3], 'ã„‹ã„¨': [1, 2, 3], 'ã„‹ã„©': [2, 3],
                    'ã„Œã„š': [0, 1, 2, 3], 'ã„Œã„›': [1], 'ã„Œã„œ': [3], 'ã„Œã„': [1, 3], 'ã„Œã„Ÿ': [1, 2, 3], 'ã„Œã„ ': [0, 1, 2, 3], 'ã„Œã„¡': [0, 1, 2, 3], 
                    'ã„Œã„¢': [1, 2, 3], 'ã„Œã„¤': [1, 2, 3], 'ã„Œã„¥': [0, 1, 3], 'ã„Œã„§': [0, 1, 2, 3], 'ã„Œã„¨': [0, 1, 2, 3], 'ã„Œã„©': [1, 2, 3],
                    'ã„ã„š': [0, 1, 3], 'ã„ã„œ': [0, 1, 2, 3], 'ã„ã„': [0, 2, 3], 'ã„ã„Ÿ': [2], 'ã„ã„ ': [0, 2, 3], 'ã„ã„¡': [0, 3], 
                    'ã„ã„¢': [0, 2, 3], 'ã„ã„£': [0, 2, 3], 'ã„ã„¤': [0, 2, 3], 'ã„ã„¥': [0, 2, 3], 'ã„ã„¨': [0, 2, 3],
                    'ã„ã„š': [0, 2, 3], 'ã„ã„œ': [0, 1, 2, 3], 'ã„ã„': [0, 2, 3], 'ã„ã„ ': [0, 2, 3], 'ã„ã„¡': [0, 3], 
                    'ã„ã„¢': [0, 1, 2, 3], 'ã„ã„£': [0, 2, 3], 'ã„ã„¤': [0, 1, 2, 3], 'ã„ã„¥': [0, 3], 'ã„ã„¨': [0, 2, 3],
                    'ã„ã„š': [0, 1, 2, 3], 'ã„ã„œ': [0, 1, 2, 3], 'ã„ã„': [0, 1, 2, 3], 'ã„ã„Ÿ': [0], 'ã„ã„ ': [0, 1, 2, 3], 'ã„ã„¡': [0, 2, 3], 
                    'ã„ã„¢': [0, 1, 2, 3], 'ã„ã„£': [0, 2, 3], 'ã„ã„¤': [0, 1, 2, 3], 'ã„ã„¥': [0, 1, 2, 3], 'ã„ã„¨': [0, 1, 2, 3],
                    'ã„ã„§': [0, 1, 2, 3], 'ã„ã„©': [0, 1, 2, 3],
                    'ã„‘ã„§': [0, 1, 2, 3], 'ã„‘ã„©': [0, 1, 2, 3],
                    'ã„’ã„§': [0, 1, 2, 3], 'ã„’ã„©': [0, 1, 2, 3],
                    'ã„“ã„š': [0, 1, 2, 3], 'ã„“ã„œ': [0, 1, 2, 3], 'ã„“ã„': [0, 1, 2, 3], 'ã„“ã„ ': [0, 1, 2, 3], 'ã„“ã„¡': [0, 1, 2, 3], 
                    'ã„“ã„¢': [0, 2, 3], 'ã„“ã„£': [0, 2, 3], 'ã„“ã„¤': [0, 2, 3], 'ã„“ã„¥': [0, 2, 3], 'ã„“ã„¨': [0, 1, 2, 3],
                    'ã„”ã„š': [0, 1, 2, 3], 'ã„”ã„œ': [0, 2, 3], 'ã„”ã„': [0, 1, 3], 'ã„”ã„ ': [0, 1, 2, 3], 'ã„”ã„¡': [0, 1, 2, 3], 
                    'ã„”ã„¢': [0, 1, 2, 3], 'ã„”ã„£': [0, 1, 2, 3], 'ã„”ã„¤': [0, 1, 2, 3], 'ã„”ã„¥': [0, 1, 2, 3], 'ã„”ã„¨': [0, 1, 2, 3],
                    'ã„•ã„š': [0, 2, 3], 'ã„•ã„œ': [0, 1, 2, 3], 'ã„•ã„': [0, 3], 'ã„•ã„ ': [0, 1, 2, 3], 'ã„•ã„¡': [0, 2, 3], 
                    'ã„•ã„¢': [0, 2, 3], 'ã„•ã„£': [0, 1, 2, 3], 'ã„•ã„¤': [0, 2, 3], 'ã„•ã„¥': [0, 1, 2, 3], 'ã„•ã„¨': [0, 1, 2, 3],
                    'ã„–ã„œ': [3], 'ã„–ã„ ': [1, 2, 3], 'ã„–ã„¡': [1, 3], 'ã„–ã„¢': [1, 2, 3], 'ã„–ã„£': [1, 2, 3], 
                    'ã„–ã„¤': [1, 2, 3], 'ã„–ã„¥': [0, 1], 'ã„–ã„¨': [1, 2, 3],
                    'ã„—ã„š': [0, 1, 2], 'ã„—ã„œ': [0, 1, 2, 3], 'ã„—ã„': [0, 3], 'ã„—ã„ ': [0, 2, 3], 'ã„—ã„¡': [0, 2, 3], 
                    'ã„—ã„¢': [0, 1, 3], 'ã„—ã„£': [2], 'ã„—ã„¤': [0, 1, 3], 'ã„—ã„¥': [0, 3], 'ã„—ã„¨': [0, 1, 2, 3],
                    'ã„˜ã„š': [0, 1], 'ã„˜ã„œ': [3], 'ã„˜ã„': [0, 1, 2, 3], 'ã„˜ã„ ': [0, 2, 3], 'ã„˜ã„¡': [0, 3], 
                    'ã„˜ã„¢': [0, 1, 2, 3], 'ã„˜ã„£': [0, 1], 'ã„˜ã„¤': [0, 1, 2], 'ã„˜ã„¥': [0, 1, 2, 3], 'ã„˜ã„¨': [0, 1, 2, 3],
                    'ã„™ã„š': [0, 2, 3], 'ã„™ã„œ': [3], 'ã„™ã„': [0, 3], 'ã„™ã„ ': [0, 2, 3], 'ã„™ã„¡': [0, 2, 3], 
                    'ã„™ã„¢': [0, 2, 3], 'ã„™ã„£': [0], 'ã„™ã„¤': [0, 2, 3], 'ã„™ã„¥': [0], 'ã„™ã„¨': [0, 1, 2, 3]
                };

                const colors = [
                    '#FF9AA2', '#B5EAD7', '#FFDAC1', '#90CCF4', '#F3D250', 
                    '#C7CEEA', '#FAB1A0', '#81ECEC', '#FFB7B2', '#E2F0CB', '#957DAD'
                ];

                let rotInitial = 0;
                let rotFinal = 0;
                let rotTone = 0;
                let currentSpeechText = '';

                // ç”¢ç”Ÿ validMap
                const validMap = {};
                initials.forEach(i => validMap[i] = []);
                
                for (let key in toneDatabase) {
                    let i = key.substring(0, 1);
                    let f = key.substring(1);
                    if (validMap[i] && !validMap[i].includes(f)) {
                        validMap[i].push(f);
                    }
                }

                function createWheel(id, items) {
                    const wheel = document.getElementById(id);
                    if(!wheel) return; // å®‰å…¨æª¢æŸ¥
                    const count = items.length;
                    const anglePerItem = 360 / count;
                    
                    let gradientStr = '';
                    items.forEach((item, index) => {
                        const startDeg = index * anglePerItem;
                        const endDeg = (index + 1) * anglePerItem;
                        const color = colors[index % colors.length];
                        gradientStr += `${color} ${startDeg}deg ${endDeg}deg,`;
                        
                        const el = document.createElement('div');
                        el.className = 'wheel-item';
                        const itemCenterDeg = startDeg + (anglePerItem / 2);
                        
                        el.style.transform = `rotate(${itemCenterDeg}deg)`;
                        
                        let displayText = typeof item === 'object' ? item.display : item;
                        el.innerHTML = displayText;

                        wheel.appendChild(el);
                    });
                    wheel.style.background = `conic-gradient(${gradientStr.slice(0, -1)})`;
                }

                // ç¶å®šåˆ° window ä»¥ä¾¿ onclick èª¿ç”¨
                window.spinWheel = function() {
                    const btn = document.querySelector('.center-btn');
                    btn.style.pointerEvents = 'none';
                    btn.innerText = '...';
                    document.querySelector('.speak-btn').style.display = 'none';

                    const target = getRandomValidCombo();

                    const calcTargetRotation = (idx, count, currentRot) => {
                        const angleStep = 360 / count;
                        const itemCenter = (idx * angleStep) + (angleStep / 2);
                        const degreesToRotate = 360 - itemCenter;
                        const currentFullSpins = Math.floor(currentRot / 360);
                        const targetFullSpins = currentFullSpins + 5; 
                        return (targetFullSpins * 360) + degreesToRotate;
                    };

                    rotInitial = calcTargetRotation(target.iIdx, initials.length, rotInitial);
                    rotFinal = calcTargetRotation(target.fIdx, finals.length, rotFinal);
                    rotTone = calcTargetRotation(target.tIdx, tones.length, rotTone);

                    document.getElementById('wheel-initial').style.transform = `rotate(${rotInitial}deg)`;
                    
                    setTimeout(() => {
                        document.getElementById('wheel-final').style.transform = `rotate(${rotFinal}deg)`;
                    }, 200);

                    setTimeout(() => {
                        document.getElementById('wheel-tone').style.transform = `rotate(${rotTone}deg)`;
                    }, 400);

                    setTimeout(() => {
                        showResult(target.val.i, target.val.f, target.val.t);
                        btn.style.pointerEvents = 'auto';
                        btn.innerText = 'é–‹å§‹';
                    }, 4400);
                }

                window.safeSpeakResult = function() {
                    if (!currentSpeechText) return;
                    
                    // å®‰å…¨æª¢æŸ¥ï¼šç€è¦½å™¨æ˜¯å¦æ”¯æ´
                    if (!('speechSynthesis' in window)) {
                        alert("æ‚¨çš„è£ç½®ç€è¦½å™¨ä¸æ”¯æ´ç™¼éŸ³åŠŸèƒ½");
                        return;
                    }

                    try {
                        window.speechSynthesis.cancel();
                        const u = new SpeechSynthesisUtterance(currentSpeechText);
                        u.lang = 'zh-TW'; // æœ€æ¨™æº–çš„è¨­å®š
                        u.rate = 0.5;
                        u.volume = 1;
                        // ä¸æŒ‡å®š voice ç‰©ä»¶ï¼Œè®“ OS æ±ºå®šï¼Œä»¥æé«˜ç›¸å®¹æ€§
                        window.speechSynthesis.speak(u);
                    } catch (e) {
                        console.error("Speech error:", e);
                        alert("ç™¼éŸ³åŠŸèƒ½ç™¼ç”ŸéŒ¯èª¤");
                    }
                }

                function getRandomValidCombo() {
                    let safetyCounter = 0;
                    while(safetyCounter < 500) { 
                        safetyCounter++;
                        const randomInitial = initials[Math.floor(Math.random() * initials.length)];
                        const allowedFinals = validMap[randomInitial];
                        if (!allowedFinals || allowedFinals.length === 0) continue;
                        const randomFinalChar = allowedFinals[Math.floor(Math.random() * allowedFinals.length)];
                        const key = randomInitial + randomFinalChar;
                        const allowedTonesIndices = toneDatabase[key];
                        if (!allowedTonesIndices || allowedTonesIndices.length === 0) continue;
                        const validTonesIndices = allowedTonesIndices.filter(idx => idx >= 0 && idx < tones.length);
                        if (validTonesIndices.length === 0) continue;
                        const randomToneIndex = validTonesIndices[Math.floor(Math.random() * validTonesIndices.length)];
                        const randomTone = tones[randomToneIndex];
                        return {
                            iIdx: initials.indexOf(randomInitial),
                            fIdx: finals.indexOf(randomFinalChar),
                            tIdx: randomToneIndex, 
                            val: { i: randomInitial, f: randomFinalChar, t: randomTone }
                        };
                    }
                    return { iIdx: 0, fIdx: 0, tIdx: 0, val: { i: 'ã„…', f: 'ã„š', t: tones[0] } };
                }

                function showResult(i, f, t) {
                    document.getElementById('res-initial').innerText = i;
                    document.getElementById('res-final').innerText = f;
                    if (t) {
                        document.getElementById('res-tone').innerText = t.display;
                        const toneMark = t.display.trim(); 
                        let fullText = `${i}${f}${toneMark}`;
                        document.getElementById('res-text').innerText = `æ‹¼éŸ³çµæœï¼š${fullText}`;
                        currentSpeechText = fullText;
                        document.querySelector('.speak-btn').style.display = 'inline-flex';
                    }
                    const boxes = document.querySelectorAll('.result-box');
                    boxes.forEach(box => {
                        box.style.transform = 'scale(1.1)';
                        setTimeout(() => box.style.transform = 'scale(1)', 200);
                    });
                }

                // å•Ÿå‹• (ç¢ºä¿åœ¨ DOMContentLoaded å…§åŸ·è¡Œ)
                createWheel('wheel-initial', initials);
                createWheel('wheel-final', finals);
                createWheel('wheel-tone', tones);
                
            } catch (err) {
                console.error("Init Error:", err);
                // è¬ä¸€ JS å´©æ½°ï¼Œè‡³å°‘ä¸æœƒä¸€ç‰‡ç©ºç™½ï¼Œå› ç‚º HTML çµæ§‹é‚„åœ¨
            }
        });
    </script>
</body>
</html>
